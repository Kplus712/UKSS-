<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Dashboard - UKSS Voting Results</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body { font-family: Arial, sans-serif; background:#f4fff4; color:#222; margin:0; padding:20px; }
  header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
  h1 { color: forestgreen; margin:0; font-size:20px; }
  .hamburger { width:36px; height:28px; display:flex; flex-direction:column; justify-content:space-between; cursor:pointer; }
  .hamburger span { display:block; height:4px; background:forestgreen; border-radius:3px; }
  .topbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:12px 0 18px 0; }
  .panel { background:white; border-radius:10px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,.08); margin-bottom:14px; }
  .table-container { width:100%; margin:12px 0; }
  table { width:100%; border-collapse:collapse; }
  th, td { padding:8px; border:1px solid #e6e6e6; text-align:left; font-size:14px; }
  th { background:forestgreen; color:white; }
  .charts { display:flex; flex-wrap:wrap; gap:16px; justify-content:center; }
  canvas { background: white; border-radius:8px; padding:8px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:999; animation:fadeIn .3s ease; }
  .modal .content { background:#fff; width:92%; max-width:980px; border-radius:10px; padding:16px; max-height:86vh; overflow:auto; position:relative; animation:zoomIn .3s ease; }
  .close-btn { position:absolute; top:12px; right:12px; background:crimson; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  .small { font-size:13px; color:#555; }
  .menu-list { display:flex; flex-direction:column; gap:8px; padding:10px; }
  .menu-list button { text-align:left; padding:8px 10px; border-radius:8px; background:#f1f8f1; border:1px solid #d8efd8; cursor:pointer; }
  .menu-list button:hover { background:#e6f4e6; }

  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  @keyframes zoomIn { from {transform:scale(0.8); opacity:0;} to {transform:scale(1); opacity:1;} }
</style>
</head>
<body>

<header>
  <div>
    <h1>üìä UKSS LIVE RESULTS DASHBOARD</h1>
    <div style="font-size:13px; color:#666;">Admin control panel</div>
  </div>

  <div style="display:flex; align-items:center; gap:8px;">
    <div title="Menu" class="hamburger" id="hamburgerBtn" onclick="openMenuPopup()">
      <span></span><span></span><span></span>
    </div>
  </div>
</header>

<div class="topbar panel">
  <div>
    <input id="searchName" placeholder="Search voter name" />
    <select id="filterClass">
      <option value="">All Classes</option>
      <option>Form One</option><option>Form Two</option><option>Form Three</option><option>Form Four</option>
    </select>
    <select id="filterGender">
      <option value="">All Genders</option><option>Male</option><option>Female</option>
    </select>
    <select id="filterPosition">
      <option value="">All Positions</option>
      <option value="headBoy">headBoy</option><option value="headGirl">headGirl</option>
      <option value="generalSec">generalSec</option><option value="discipline">discipline</option>
    </select>
    <button id="clearFilters">Clear</button>
  </div>
  <div id="topSummary" class="small" style="margin-left:auto;">Loading...</div>
</div>

<div id="winnerSummary" class="panel table-container"></div>
<div id="resultsContainer" class="panel"></div>

<div class="charts">
  <canvas id="barChart" width="600" height="260"></canvas>
  <canvas id="pieChart" width="360" height="260"></canvas>
  <canvas id="lineChart" width="600" height="260"></canvas>
</div>

<div id="timelineContainer" class="panel table-container"></div>

<!-- ================= Menu Popup (Hamburger) ================= -->
<div id="menuPopup" class="modal">
  <div class="content">
    <button class="close-btn" onclick="closeMenuPopup()">‚úñ</button>
    <h2 style="color:forestgreen;">‚ò∞ Admin Menu</h2>
    <div class="menu-list">
      <button onclick="openVotersModal()">üßæ View All Voters List</button>
      <button onclick="openRegisteredModal()">üìã Registered Voters List</button>
      <button onclick="confirmDeleteAll()">üóëÔ∏è Delete All Votes</button>
      <button onclick="triggerDownloadResults()">‚¨áÔ∏è Download Results (CSV)</button>
      <button onclick="backupVotes()">üíæ Backup Votes (JSON)</button>
      <button onclick="triggerRestore()">‚ôªÔ∏è Restore Votes (JSON)</button>
      <button onclick="closeMenuPopup()" style="background:#f5f5f5; border:1px solid #ddd;">‚ùå Close</button>
    </div>
  </div>
</div>

<!-- other modals here (unchanged for brevity) -->
<div id="votersModal" class="modal"><div class="content"><button class="close-btn" onclick="closeVotersModal()">‚úñ</button><h2>üßæ All Voters</h2><table id="votersTable"><thead><tr><th>ID</th><th>Name</th><th>Class</th><th>Gender</th><th>Votes</th><th>Time</th></tr></thead><tbody></tbody></table></div></div>
<div id="registeredModal" class="modal"><div class="content"><button class="close-btn" onclick="closeRegisteredModal()">‚úñ</button><h2>üìã Registered Voters</h2><table id="registeredTable"><thead><tr><th>ID</th><th>Name</th><th>Class</th><th>Gender</th><th>Registered</th></tr></thead><tbody></tbody></table></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

/* Firebase Config */
const app = initializeApp({
  apiKey: "AIzaSyAIabK86PrfHfzNVciI2K7aRjb8VoWyA7A",
  authDomain: "ukss-voting-system.firebaseapp.com",
  databaseURL: "https://ukss-voting-system-default-rtdb.firebaseio.com",
  projectId: "ukss-voting-system",
  storageBucket: "ukss-voting-system.firebasestorage.app",
  messagingSenderId: "525528255065",
  appId: "1:525528255065:web:97c4e55d2984acc718bf48",
  measurementId: "G-14ZV9E3X7C"
});
const db = getDatabase(app);

/* === MENU POPUP FIX === */
const menuPopup = document.getElementById("menuPopup");
function openMenuPopup() { menuPopup.style.display = "flex"; }
function closeMenuPopup() { menuPopup.style.display = "none"; }
window.openMenuPopup = openMenuPopup;
window.closeMenuPopup = closeMenuPopup;

/* === SAMPLE LIVE CHART === */
onValue(ref(db, "votes"), (snap) => {
  const data = snap.val() || {};
  console.log("‚úÖ Firebase connected: ", Object.keys(data).length, "votes found");
});
</script>
</body>
</html>

